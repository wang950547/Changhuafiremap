<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Changhua</title>
    <link href="css/hospitalButton.css" rel="stylesheet" type="text/css">

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDI5M8jjDj2lmurSJSDQR6LL_9fSiZCgcY"
            type="text/javascript"></script>
    <script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>

    <!--讀出彰化縣醫院的資料-->
    <script type="text/javascript" src = "js/allChanghuaHospital.js"></script>

    <!--讀出彰化縣geojson-->
    <script type="text/javascript" src = "js/ChanghuaCountry.js"></script>
    <!--地圖初始化-->
    <script>
        var m = null;
        function initialize() {
            var latlng = { lat: 23.984064, lng: 120.507191 };
            var map = new google.maps.Map(document.getElementById('googleMap'), {
                zoom: 11,
                center: latlng,
                mapTypeId:google.maps.MapTypeId.ROADMAP
            });
            m = map;
        }
        google.maps.event.addDomListener(window, 'load', initialize);
    </script>

    <script>
        var markers = [];
        var isShowed = false;
        <!--標出彰化醫院位置-->
        function displayChanghuaAllHospital(map)
        {
            if(!isShowed) {
                var hospitals = JSON.parse(JSON.stringify(json));
                var image = {
                    url: 'img/images.jpg',
                    size: new google.maps.Size(32, 32),
                    // The origin for this image is (0, 0).
                    origin: new google.maps.Point(0, 0),
                    // The anchor for this image is the base of the flagpole at (0, 32).
                    anchor: new google.maps.Point(0, 32)
                };
                for (var i = 0; i < hospitals.hospital.length; i++) {
                    var h = hospitals.hospital[i];
                    var info = h.name + "<br/>" + h.address;
                    var marker = new google.maps.Marker({
                        position: {lat: h.lat_H, lng: h.lng_H},
                        map: map,
                        icon: image,
                        title: h.name,
                        html: info
                    });
                    var infowindow = new google.maps.InfoWindow({
                        content: info
                    });
                    google.maps.event.addListener( marker , 'click', function(info) {
                        infowindow.setContent(this.html);
                        infowindow.open(map,this);
                    });
                    markers.push(marker);
                }
                isShowed = true;
                document.getElementById("showHospitalLocation").innerHTML = "Hide Hospitals' Location";
            }
            else
            {
                for(var i = 0; i < markers.length; i++)
                {
                    markers[i].setMap(null);
                }
                isShowed = false;
                document.getElementById("showHospitalLocation").innerHTML = "Show Hospitals' Location";
            }

        }
        var fireMapIsShow = false;
        function displayChanghuaCity(map)
        {
            if(!fireMapIsShow) {
                var geoString = JSON.stringify(geojson);
                var geoJson = JSON.parse(geoString);
                var features = map.data.addGeoJson(geoJson);
                google.maps.event.addDomListener(document.getElementById('showCityArea'), 'click', function () {
                    for (var i = 0; i < features.length; i++)
                        map.data.remove(features[i]);
                });
                map.data.addListener('mouseover', function(event) {
                    document.getElementById('info-box').innerHTML =
                     event.feature.getProperty('C_Name')
                    + event.feature.getProperty('T_Name')
                    + "<br/>fire_Value:" + event.feature.getProperty('fire_Value');
                });
                var r = 255;
                var g = 255;
                var b = 0;

                map.data.setStyle(function(feature) {
                    g = 255;
                    var fireVal = feature.getProperty('fire_Value');
                    g = g - (fireVal * 10);
                    return /** @type {google.maps.Data.StyleOptions} */({
                        fillColor: rgbToHex(r , g , b),
                        fillOpacity:0.5,
                        strokeWeight: 3
                    });
                });
                fireMapIsShow = true;
                document.getElementById("showCityArea").innerHTML = "Hide ChangHua's FireMap";
            }
            else
            {
                fireMapIsShow = false;
                document.getElementById("showCityArea").innerHTML = "Show ChangHua's FireMap";
            }

            function rgbToHex(r, g, b) {
                return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
            }

            function componentToHex(c) {
                var hex = c.toString(16);
                return hex.length == 1 ? "0" + hex : hex;
            }

        }
    </script>

</head>

<body>

<div id="googleMap" style="width:800px;height:600px;">

</div>
<div id="info-box" style="font-size: 20px"></div>
<br/>
<br/>
<div class="hospitalbutton">
    <a id = "showHospitalLocation" onkeypress="displayChanghuaAllHospital(m);" onclick="displayChanghuaAllHospital(m);">Show Hospitals' Location</a>
</div>
<div class="citybutton">
    <a id = "showCityArea" onkeypress="displayChanghuaCity(m);" onclick="displayChanghuaCity(m);">Show ChangHua's FireMap</a>
</div>
</body>
</html>
